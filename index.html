Prova 3 di gioco con delitto: avanzamento 3
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Interrogatorio AI – Versione Groq</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #222;
      color: #eee;
      margin: 0;
      padding: 0;
    }
    #container {
      max-width: 900px;
      margin: 20px auto;
      background: #333;
      padding: 20px;
      border-radius: 10px;
    }
    .row { margin-bottom: 20px; }
    textarea {
      width: 100%;
      height: 120px;
      padding: 10px;
      border-radius: 6px;
      border: none;
      resize: vertical;
      font-size: 15px;
    }
    select, input {
      padding: 8px;
      border-radius: 6px;
      border: none;
      width: 100%;
    }
    button {
      padding: 10px;
      width: 100%;
      background: #4CAF50;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }
    #output {
      white-space: pre-wrap;
      background: #111;
      padding: 15px;
      border-radius: 8px;
      min-height: 150px;
    }
  </style>
</head>

<body>
<div id="container">
  <h2>Simulatore di Interrogatorio AI</h2>

  <div class="row">
    <label>API Key Groq</label>
    <input type="password" id="apiKey" placeholder="Inserisci la tua API Key Groq">
  </div>

  <div class="row">
    <label>Seleziona sospettato</label>
    <select id="sospettato">
      <option value="">-- scegli --</option>
      <option value="marco">Marco – il vicino sospettoso</option>
      <option value="anna">Anna – la collega troppo perfetta</option>
      <option value="luca">Luca – il fratello nervoso</option>
    </select>
  </div>

  <div class="row">
    <label>Domanda dell’ispettore</label>
    <textarea id="domanda"></textarea>
  </div>

  <button onclick="inviaDomanda()">Interroga</button>

  <h3>Risposta:</h3>
  <div id="output"></div>
</div>

<script>
/* ------------------------------------------------------------------
   PROFILI DEI PERSONAGGI – puoi arricchirli quando vuoi
-------------------------------------------------------------------*/
const profili = {
  marco: `
    Marco ha 45 anni, vive da solo, carattere irascibile ma controllato.
    La sua casa è di fronte al luogo del delitto.
    Dice di aver sentito rumori, ma non è chiaro l’orario.
    In tasca aveva uno scontrino per guanti in lattice.
  `,
  anna: `
    Anna è una collega della vittima.
    Elegante, precisa, estremamente ordinata.
    Dice di essere stata a casa a leggere.
    Nel suo borsone sono stati trovati documenti strappati.
  `,
  luca: `
    Luca è il fratello minore della vittima.
    Personalità impulsiva, a volte aggressiva.
    Avevano litigato due giorni fa per una questione di soldi.
    Sul tavolo di Luca c’era una ricevuta per un coltello da cucina.
  `
};


/* ------------------------------------------------------------------
   MEMORIA DEL DIALOGO
-------------------------------------------------------------------*/
let memoria = [];


/* ------------------------------------------------------------------
   FUNZIONE PRINCIPALE DI CHIAMATA A GROQ
   (corretta, testata, funzionante)
-------------------------------------------------------------------*/
async function callGroq(apiKey, messages) {
  const endpoint = "https://api.groq.com/openai/v1/chat/completions";

  const response = await fetch(endpoint, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${apiKey}`
    },
    body: JSON.stringify({
      //model: "llama3-70b-8192",
      model: "llama-3.1-8b-instant",
      messages: messages,
      temperature: 0.8,
      max_tokens: 600
    })
  });

  if (!response.ok) {
    const err = await response.text();
    throw new Error("Errore Groq: " + err);
  }

  const data = await response.json();
  return data.choices[0].message.content;
}


/* ------------------------------------------------------------------
   GESTIONE DELLE DOMANDE E RISPOSTE
-------------------------------------------------------------------*/
async function inviaDomanda() {

  const apiKey = document.getElementById("apiKey").value.trim();
  const persona = document.getElementById("sospettato").value;
  const domanda = document.getElementById("domanda").value.trim();
  const output = document.getElementById("output");

  if (!apiKey) return output.innerText = "Errore: devi inserire la API key.";
  if (!persona) return output.innerText = "Errore: devi selezionare un sospettato.";
  if (!domanda) return output.innerText = "Scrivi prima una domanda.";

  output.innerText = "Attendere...";

  try {

    const contesto = `
    Sei ${persona}. Ecco il tuo profilo:
    ${profili[persona]}
    Devi rispondere all'ispettore in modo coerente, naturale, realistico.
    Mantieni la tua personalità e non uscire dal ruolo.
    `;

    memoria.push({ role: "user", content: domanda });

    const messaggi = [
      { role: "system", content: contesto },
      ...memoria
    ];

    const risposta = await callGroq(apiKey, messaggi);

    memoria.push({ role: "assistant", content: risposta });

    output.innerText = risposta;

  } catch (e) {
    output.innerText = "Errore: " + e.message;
  }
}
</script>

</body>
</html>

//"Authorization": "Bearer gsk_Yn6sh0pF8Er4kN7mcZrlWGdyb3FYlSrmDTtcNa3Z7eOLCjgmGw4X0"
           
              //  model: "llama-3.1-8b-instant",
               
