Prova 3 di gioco con delitto: avanzamento 3
<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Delitto in Villa ‚Äì Interrogatorio Avanzato</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        display: flex;
        background: #eee;
    }

    /* SIDEBAR */
    #sidebar {
        width: 330px;
        background: #222;
        color: white;
        padding: 20px;
        height: 100vh;
        overflow-y: auto;
    }

    #sidebar h2 {
        margin-top: 0;
    }

    .input-block {
        margin-bottom: 15px;
    }

    .input-block input, .input-block textarea, select {
        width: 100%;
        padding: 6px;
        margin-top: 5px;
    }

    #main {
        flex-grow: 1;
        padding: 20px;
    }

    .suspect-btn {
        padding: 10px;
        margin: 5px;
        font-size: 16px;
        cursor: pointer;
    }

    #response {
        margin-top: 20px;
        padding: 15px;
        background: white;
        min-height: 120px;
        white-space: pre-wrap;
    }
</style>
</head>

<body>

<!-- SIDEBAR: TOOLBOX AVANZATO -->
<div id="sidebar">
    <h2>üõ†Ô∏è Strumenti</h2>

    <div class="input-block">
        <label>API Key Groq</label>
        <input id="apiKey" type="password" placeholder="incolla qui la tua API key‚Ä¶">
    </div>

    <hr style="margin:20px 0;">

    <h3>üé≠ Gestione Sospettati</h3>

    <div class="input-block">
        <label>Seleziona sospettato</label>
        <select id="suspectSelector"></select>
    </div>

    <div class="input-block">
        <label>Ruolo / Personalit√†</label>
        <textarea id="s_personality" rows="4"></textarea>
    </div>

    <div class="input-block">
        <label>Alibi / Info segrete</label>
        <textarea id="s_backstory" rows="4"></textarea>
    </div>

    <button onclick="saveSuspectData()">üíæ Salva Profilo</button>

    <hr style="margin:20px 0;">

    <h3>üß† Memoria</h3>
    <button onclick="clearMemory()">‚ùå Reset memoria</button>

</div>


<!-- MAIN AREA -->
<div id="main">
    <h1>Delitto in Villa ‚Äì Interrogatorio</h1>

    <p>Scegli un sospettato:</p>
    <div id="suspectButtons"></div>

    <hr>

    <h2>Fai una domanda</h2>
    <input id="question" type="text" style="width:70%;padding:10px;" placeholder="Scrivi la domanda‚Ä¶">
    <button onclick="ask()" style="padding:10px;">Invia</button>

    <div id="response"></div>
</div>


<script>
/* -----------------------------
   PERSONAGGI INIZIALI
--------------------------------*/
let suspects = {
    "maggiordomo": {
        name: "Maggiordomo",
        personality: "Distaccato, preciso, molto controllato.",
        backstory: "Dice di essere stato in cucina ma ha un taglio sospetto sul polso."
    },
    "madre": {
        name: "Madre",
        personality: "Elegante, protettiva, tende a manipolare.",
        backstory: "Trovata vicino alla biblioteca poco dopo il delitto."
    },
    "giardiniere": {
        name: "Giardiniere",
        personality: "Ruvido ma sincero. Conosce molti segreti della villa.",
        backstory: "Era nel parco, afferma di aver visto qualcuno correre."
    }
};

let conversationMemory = [];
let currentSuspect = "maggiordomo";

function init() {
    const sel = document.getElementById("suspectSelector");
    const btns = document.getElementById("suspectButtons");

    for (let key in suspects) {
        let s = suspects[key];

        // aggiunge pulsanti principali
        let b = document.createElement("button");
        b.className = "suspect-btn";
        b.textContent = s.name;
        b.onclick = () => loadSuspect(key);
        btns.appendChild(b);

        // aggiunge al selector del toolbox
        let opt = document.createElement("option");
        opt.value = key;
        opt.textContent = s.name;
        sel.appendChild(opt);
    }

    loadSuspect("maggiordomo");
}

function loadSuspect(key) {
    currentSuspect = key;
    const s = suspects[key];

    document.getElementById("suspectSelector").value = key;
    document.getElementById("s_personality").value = s.personality;
    document.getElementById("s_backstory").value = s.backstory;

    document.getElementById("response").textContent =
        "Hai selezionato " + s.name + ". Puoi iniziare l'interrogatorio.";
}

function saveSuspectData() {
    let key = document.getElementById("suspectSelector").value;
    suspects[key].personality = document.getElementById("s_personality").value;
    suspects[key].backstory = document.getElementById("s_backstory").value;

    alert("Profilo aggiornato.");
}

function clearMemory() {
    conversationMemory = [];
    document.getElementById("response").textContent = "Memoria cancellata.";
}


/* -----------------------------
   CHIAMATA A GROQ
--------------------------------*/
async function ask() {
    const apiKey = document.getElementById("apiKey").value;
    if (!apiKey) {
        alert("Inserisci la API Key!");
        return;
    }

    const question = document.getElementById("question").value;
    if (!question) return;

    const output = document.getElementById("response");
    output.textContent = "Sto pensando‚Ä¶";

    const s = suspects[currentSuspect];

    let systemPrompt =
        `Sei il sospettato: ${s.name}.
Personalit√†: ${s.personality}.
Informazioni segrete: ${s.backstory}.
Il dialogo deve essere coerente, realistico, e con tensione narrativa.
Mantieni continuit√† usando la memoria conversazionale seguente.`;

    // memoria conversazionale AI
    let memoryMessages = conversationMemory.map(m => ({role: m.role, content: m.content}));

    const fullMessages = [
        { role: "system", content: systemPrompt },
        ...memoryMessages,
        { role: "user", content: question }
    ];

    try {
        const resp = await fetch("https://api.groq.com/openai/v1/chat/completions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + apiKey
            },
            body: JSON.stringify({
                model: "llama-3.1-8b-instant",
                messages: fullMessages,
                temperature: 0.7,
                max_tokens: 250
            })
        });

        const data = await resp.json();

        if (!data.choices || !data.choices[0]) {
            output.textContent = "Errore: " + JSON.stringify(data, null, 2);
            return;
        }

        let ai = data.choices[0].message.content;
        output.textContent = ai;

        conversationMemory.push({role: "user", content: question});
        conversationMemory.push({role: "assistant", content: ai});

    } catch (err) {
        output.textContent = "Errore: " + err.message;
    }
}

init();
</script>

</body>
</html>


//"Authorization": "Bearer gsk_Yn6sh0pF8Er4kN7mcZrlWGdyb3FYlSrmDTtcNa3Z7eOLCjgmGw4X0"
           
              //  model: "llama-3.1-8b-instant",
               
