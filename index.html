<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Assistant Minimal</title>

<style>
    body {
        font-family: sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        height: 100vh;
    }
    #chat {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
    }
    #inputArea {
        display: flex;
        border-top: 1px solid #ccc;
    }
    #userInput {
        flex: 1;
        padding: 10px;
        border: none;
        font-size: 16px;
    }
    #sendBtn, #micBtn {
        padding: 10px 15px;
        font-size: 20px;
        border: none;
        background: #eee;
        cursor: pointer;
    }
    #micBtn.listening {
        background: #ffdddd;
    }
</style>

</head>
<body>

<div id="chat"></div>

<div id="inputArea">
    <input id="userInput" type="text" placeholder="Scrivi o parla..." />
    <button id="micBtn">üé§</button>
    <button id="sendBtn">‚û°Ô∏è</button>
</div>

<script>
/* ---------------------------
    SINTESI VOCALE
-----------------------------*/
function speak(text) {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "it-IT";
    speechSynthesis.speak(u);
}

/* ---------------------------
    CHAT LOGIC
-----------------------------*/
async function sendMessage(text) {
    if (!text.trim()) return;

    appendMessage("Tu", text);
    userInput.value = "";

    // --- chiamata a OpenAI API (sostituisci con la tua chiave) ---
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer YOUR_API_KEY"
        },
        body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [{ role: "user", content: text }]
        })
    });

    const data = await response.json();
    const reply = data.choices[0].message.content;

    appendMessage("Assistente", reply);
    speak(reply);
}

function appendMessage(sender, text) {
    const chat = document.getElementById("chat");
    const div = document.createElement("div");
    div.textContent = sender + ": " + text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

const userInput = document.getElementById("userInput");
document.getElementById("sendBtn").onclick = () => sendMessage(userInput.value);

/* ---------------------------
    RICONOSCIMENTO VOCALE
-----------------------------*/
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognition;

if (SpeechRecognition) {
    recognition = new SpeechRecognition();
    recognition.lang = "it-IT";
    recognition.interimResults = false;   // restituisce solo il testo finale
    recognition.continuous = false;       // si ferma da sola

    recognition.onresult = (event) => {
        const text = event.results[0][0].transcript;
        sendMessage(text);
        micBtn.classList.remove("listening");
    };

    recognition.onend = () => {
        micBtn.classList.remove("listening");
    };
}

const micBtn = document.getElementById("micBtn");
micBtn.onclick = () => {
    if (!recognition) {
        alert("Il riconoscimento vocale non √® supportato su questo browser.");
        return;
    }
    recognition.start();
    micBtn.classList.add("listening");
};

</script>

</body>
</html>
